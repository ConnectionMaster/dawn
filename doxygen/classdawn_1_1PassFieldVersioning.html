<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Dawn: dawn::PassFieldVersioning Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dawn
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Compiler toolchain for developing high-level DSLs for geophysical fluid dynamics models</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classdawn_1_1PassFieldVersioning.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classdawn_1_1PassFieldVersioning-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">dawn::PassFieldVersioning Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This pass resolves potential race condition by introducing double buffering i.e versioning of fields.  
 <a href="classdawn_1_1PassFieldVersioning.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="PassFieldVersioning_8h_source.html">PassFieldVersioning.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for dawn::PassFieldVersioning:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classdawn_1_1PassFieldVersioning.png" usemap="#dawn::PassFieldVersioning_map" alt=""/>
  <map id="dawn::PassFieldVersioning_map" name="dawn::PassFieldVersioning_map">
<area href="classdawn_1_1Pass.html" title="Abstract base class of all optimization and analyzer passes. " alt="dawn::Pass" shape="rect" coords="0,0,164,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a4d5c854960aa1e82e00a4d5a6c704044"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdawn_1_1PassFieldVersioning.html#a4d5c854960aa1e82e00a4d5a6c704044">RCKind</a> { <a class="el" href="classdawn_1_1PassFieldVersioning.html#a4d5c854960aa1e82e00a4d5a6c704044a4b4152fc23c3b668af4984a4c325e2a2">RCKind::RK_Nothing</a> = 0, 
<a class="el" href="classdawn_1_1PassFieldVersioning.html#a4d5c854960aa1e82e00a4d5a6c704044a316f108b945417e2dc00b4b133a9ef0e">RCKind::RK_Fixed</a>, 
<a class="el" href="classdawn_1_1PassFieldVersioning.html#a4d5c854960aa1e82e00a4d5a6c704044a0b68f8d0f7dfcc4b4739b3bb0c17d9ea">RCKind::RK_Unresolvable</a>
 }<tr class="memdesc:a4d5c854960aa1e82e00a4d5a6c704044"><td class="mdescLeft">&#160;</td><td class="mdescRight">Kind of race condition encountered.  <a href="classdawn_1_1PassFieldVersioning.html#a4d5c854960aa1e82e00a4d5a6c704044">More...</a><br /></td></tr>
</td></tr>
<tr class="separator:a4d5c854960aa1e82e00a4d5a6c704044"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af54cf17d74509cfeca4e50fc8d1cba01"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af54cf17d74509cfeca4e50fc8d1cba01"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdawn_1_1PassFieldVersioning.html#af54cf17d74509cfeca4e50fc8d1cba01">run</a> (<a class="el" href="classdawn_1_1StencilInstantiation.html">StencilInstantiation</a> *stencilInstantiation) override</td></tr>
<tr class="memdesc:af54cf17d74509cfeca4e50fc8d1cba01"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classdawn_1_1Pass.html" title="Abstract base class of all optimization and analyzer passes. ">Pass</a> implementation. <br /></td></tr>
<tr class="separator:af54cf17d74509cfeca4e50fc8d1cba01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24db550e6bc895c6f5a04a5691fc31e3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classdawn_1_1PassFieldVersioning.html#a4d5c854960aa1e82e00a4d5a6c704044">RCKind</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdawn_1_1PassFieldVersioning.html#a24db550e6bc895c6f5a04a5691fc31e3">fixRaceCondition</a> (const <a class="el" href="classdawn_1_1DependencyGraphAccesses.html">DependencyGraphAccesses</a> *graph, <a class="el" href="classdawn_1_1Stencil.html">Stencil</a> &amp;stencil, <a class="el" href="classdawn_1_1DoMethod.html">DoMethod</a> &amp;doMethod, LoopOrderKind loopOrder, int stageIdx, int stmtIdx)</td></tr>
<tr class="memdesc:a24db550e6bc895c6f5a04a5691fc31e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fix race conditions by introducing double buffering of the offending fields.  <a href="#a24db550e6bc895c6f5a04a5691fc31e3">More...</a><br /></td></tr>
<tr class="separator:a24db550e6bc895c6f5a04a5691fc31e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classdawn_1_1Pass"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classdawn_1_1Pass')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classdawn_1_1Pass.html">dawn::Pass</a></td></tr>
<tr class="memitem:ab88af63262eefa5a4afe0c9dc3c1201f inherit pub_methods_classdawn_1_1Pass"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab88af63262eefa5a4afe0c9dc3c1201f"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>Pass</b> (const std::string &amp;name)</td></tr>
<tr class="separator:ab88af63262eefa5a4afe0c9dc3c1201f inherit pub_methods_classdawn_1_1Pass"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf8cb743b41dda0e96a7536504b1b13c inherit pub_methods_classdawn_1_1Pass"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abf8cb743b41dda0e96a7536504b1b13c"></a>
const std::string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdawn_1_1Pass.html#abf8cb743b41dda0e96a7536504b1b13c">getName</a> () const </td></tr>
<tr class="memdesc:abf8cb743b41dda0e96a7536504b1b13c inherit pub_methods_classdawn_1_1Pass"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the name of the <a class="el" href="classdawn_1_1Pass.html" title="Abstract base class of all optimization and analyzer passes. ">Pass</a>. <br /></td></tr>
<tr class="separator:abf8cb743b41dda0e96a7536504b1b13c inherit pub_methods_classdawn_1_1Pass"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d64c84ba5fe5aa44fa6ac81a9dc4bb9 inherit pub_methods_classdawn_1_1Pass"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8d64c84ba5fe5aa44fa6ac81a9dc4bb9"></a>
std::vector&lt; std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdawn_1_1Pass.html#a8d64c84ba5fe5aa44fa6ac81a9dc4bb9">getDependencies</a> () const </td></tr>
<tr class="memdesc:a8d64c84ba5fe5aa44fa6ac81a9dc4bb9 inherit pub_methods_classdawn_1_1Pass"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the dependencies of this pass. <br /></td></tr>
<tr class="separator:a8d64c84ba5fe5aa44fa6ac81a9dc4bb9 inherit pub_methods_classdawn_1_1Pass"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_attribs_classdawn_1_1Pass"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classdawn_1_1Pass')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="classdawn_1_1Pass.html">dawn::Pass</a></td></tr>
<tr class="memitem:a3fbbcf23487d83369a00c8c8f4237f93 inherit pro_attribs_classdawn_1_1Pass"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3fbbcf23487d83369a00c8c8f4237f93"></a>
std::vector&lt; std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdawn_1_1Pass.html#a3fbbcf23487d83369a00c8c8f4237f93">dependencies_</a></td></tr>
<tr class="memdesc:a3fbbcf23487d83369a00c8c8f4237f93 inherit pro_attribs_classdawn_1_1Pass"><td class="mdescLeft">&#160;</td><td class="mdescRight">Name of the passes this pass depends on (empty implies no dependency) <br /></td></tr>
<tr class="separator:a3fbbcf23487d83369a00c8c8f4237f93 inherit pro_attribs_classdawn_1_1Pass"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This pass resolves potential race condition by introducing double buffering i.e versioning of fields. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classdawn_1_1PassFieldVersioning.html#a24db550e6bc895c6f5a04a5691fc31e3" title="Fix race conditions by introducing double buffering of the offending fields. ">fixRaceCondition</a> </dd></dl>

<p>Definition at line <a class="el" href="PassFieldVersioning_8h_source.html#l00032">32</a> of file <a class="el" href="PassFieldVersioning_8h_source.html">PassFieldVersioning.h</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="a4d5c854960aa1e82e00a4d5a6c704044"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classdawn_1_1PassFieldVersioning.html#a4d5c854960aa1e82e00a4d5a6c704044">dawn::PassFieldVersioning::RCKind</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">strong</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Kind of race condition encountered. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a4d5c854960aa1e82e00a4d5a6c704044a4b4152fc23c3b668af4984a4c325e2a2"></a>RK_Nothing&#160;</td><td class="fielddoc">
<p>No race-condition was encountered. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a4d5c854960aa1e82e00a4d5a6c704044a316f108b945417e2dc00b4b133a9ef0e"></a>RK_Fixed&#160;</td><td class="fielddoc">
<p>Encounterd race-condition and fixed it by double buffering. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a4d5c854960aa1e82e00a4d5a6c704044a0b68f8d0f7dfcc4b4739b3bb0c17d9ea"></a>RK_Unresolvable&#160;</td><td class="fielddoc">
<p>Race condition cannot be fixed. </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="PassFieldVersioning_8h_source.html#l00042">42</a> of file <a class="el" href="PassFieldVersioning_8h_source.html">PassFieldVersioning.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a24db550e6bc895c6f5a04a5691fc31e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classdawn_1_1PassFieldVersioning.html#a4d5c854960aa1e82e00a4d5a6c704044">PassFieldVersioning::RCKind</a> dawn::PassFieldVersioning::fixRaceCondition </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classdawn_1_1DependencyGraphAccesses.html">DependencyGraphAccesses</a> *&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classdawn_1_1Stencil.html">Stencil</a> &amp;&#160;</td>
          <td class="paramname"><em>stencil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classdawn_1_1DoMethod.html">DoMethod</a> &amp;&#160;</td>
          <td class="paramname"><em>doMethod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LoopOrderKind&#160;</td>
          <td class="paramname"><em>loopOrder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stageIdx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stmtIdx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fix race conditions by introducing double buffering of the offending fields. </p>
<p>Consider the following example:</p>
<div class="fragment"><div class="line">tmp = u(i+1);</div><div class="line">u = tmp;</div></div><!-- fragment --><p>Due to our parllel model, we would have a race condition in <code>u</code>. Splitting the the two statements into two different stages is not sufficient as there is no buffering of the boundary extents. The solution is thus to introduce a <b>new</b> field i.e double buffer the field <code>u</code>.</p>
<div class="fragment"><div class="line">tmp = u_in(i+1);</div><div class="line">u_out = tmp;</div></div><!-- fragment --><p>This detects such patterns and, if applicable, fixes them. Note that not all race conditions can be resolved e.g race conditions inside stencil functions of block statements are currently not resolved and will procude a diagnostic message.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">graph</td><td>Dependency graph to analyze </td></tr>
    <tr><td class="paramname">stencil</td><td>Current stencil </td></tr>
    <tr><td class="paramname">stencil</td><td>Current Do-Method </td></tr>
    <tr><td class="paramname">loopOrder</td><td>Current loop order of the stage </td></tr>
    <tr><td class="paramname">stageIdx</td><td><b>Linear</b> index of the stage in the stencil </td></tr>
    <tr><td class="paramname">stmtIdx</td><td>Index of the statement inside the stage </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="PassFieldVersioning_8cpp_source.html#l00153">153</a> of file <a class="el" href="PassFieldVersioning_8cpp_source.html">PassFieldVersioning.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/dawn/Optimizer/<a class="el" href="PassFieldVersioning_8h_source.html">PassFieldVersioning.h</a></li>
<li>src/dawn/Optimizer/<a class="el" href="PassFieldVersioning_8cpp_source.html">PassFieldVersioning.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>dawn</b></li><li class="navelem"><a class="el" href="classdawn_1_1PassFieldVersioning.html">PassFieldVersioning</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
