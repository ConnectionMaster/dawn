

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>High-Level Intermediate Representation &mdash; Dawn 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Dawn 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="HIR Design" href="hir_design.html"/>
        <link rel="prev" title="First steps" href="basics.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Dawn
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">About this project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#core-features">Core Features</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">The Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basics.html">First steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="basics.html#compiling-the-library">Compiling the library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basics.html#linux">Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="basics.html#mac-os">Mac OS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#linking-the-library">Linking the library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basics.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#using-the-library">Using the library</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Advanced Topics</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">High-Level Intermediate Representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="hir_design.html">HIR Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="toolchain.html">Dawn toolchain</a><ul>
<li class="toctree-l2"><a class="reference internal" href="toolchain.html#parallel-model-builder">Parallel Model Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="toolchain.html#safety-checker">Safety Checker</a></li>
<li class="toctree-l2"><a class="reference internal" href="toolchain.html#optimizer">Optimizer</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="isir.html">ISIR</a></li>
<li class="toctree-l1"><a class="reference internal" href="gridtools.html">GridTools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gridtools.html#parallel-model">Parallel Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="coding.html">Dawn Coding standard</a><ul>
<li class="toctree-l2"><a class="reference internal" href="coding.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="coding.html#supported-c-11-language-and-library-features">Supported C++11 Language and Library Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="coding.html#style-issues">Style Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="coding.html#naming-of-types-functions-variables-and-enumerators">Naming of Types, Functions, Variables, and Enumerators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="coding.html#source-code-formatting">Source Code Formatting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="coding.html#source-code-width">Source Code Width</a></li>
<li class="toctree-l3"><a class="reference internal" href="coding.html#spaces-before-parentheses">Spaces Before Parentheses</a></li>
<li class="toctree-l3"><a class="reference internal" href="coding.html#pointer-and-reference-alignment">Pointer and Reference Alignment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="coding.html#clang-format">Clang Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="coding.html#shared-pointer-handeling">Shared pointer handeling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="doxygen.html">Doxygen</a></li>
<li class="toctree-l1"><a class="reference internal" href="cmake-modules.html">CMake Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cmake-modules.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmake-modules.html#functions-macros">Functions &amp; Macros</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cmake-modules/DawnExportPackage.html">dawn_export_package</a></li>
<li class="toctree-l3"><a class="reference internal" href="cmake-modules/DawnProtobufGenerate.html">dawn_protobuf_generate</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cmake-modules.html#modules">Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cmake-modules/FindClang.html">FindClang</a></li>
<li class="toctree-l3"><a class="reference internal" href="cmake-modules/FindLLVM.html">FindLLVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="cmake-modules/FindSphinx.html">FindSphinx</a></li>
<li class="toctree-l3"><a class="reference internal" href="cmake-modules/Findbash.html">Findbash</a></li>
<li class="toctree-l3"><a class="reference internal" href="cmake-modules/Findccache.html">Findccache</a></li>
<li class="toctree-l3"><a class="reference internal" href="cmake-modules/Findclang-format.html">Findclang-format</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Dawn</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>High-Level Intermediate Representation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/MeteoSwiss-APN/dawn/blob/master/docs/hir.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="high-level-intermediate-representation">
<span id="sir"></span><h1>High-Level Intermediate Representation<a class="headerlink" href="#high-level-intermediate-representation" title="Permalink to this headline">Â¶</a></h1>
<p>Developing a single DSL that is able to support all numerical methods and computational patterns present in GFD models present a serious challenge due to the wide domain it needs to cover. In this project, we accept the reality that multiple scientific communities desire to develop their own DSL language, tailored for their model and needs. The High-level Intermediate Representation (HIR) allows to define multiple high level DSLs in a lightweight manner by reusing most of a complex toolchain, i.e. domain specific optimizers, safety checkers and code generators.
In addition, a standardized HIR has another major advantage: It allows to easily interact with third-party developers and hardware manufacturers. For instance, the HIR of the <a class="reference external" href="http://www.cosmo-model.org/">COSMO</a> atmospheric model, serialized to a mark-up Language like <a class="reference external" href="https://en.wikipedia.org/wiki/JSON">JSON</a>, can be distributed to hardware vendors, which in turn have their proprietary, in-house compilers based on the HIR and can return plain C/C++ or CUDA code. This frees third-party developers from compiling the models and hopefully improves collaboration.</p>
<p>In this section we define a first draft of a specification of the HIR for structured grid weathe and climate computations.</p>
<dl class="glossary docutils">
<dt id="term-program"><cite>Program</cite></dt>
<dd><p class="first">the main program</p>
<blockquote class="last">
<div><div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>A <a class="reference internal" href="#term-globalvariablemap"><span class="xref std std-term">GlobalVariableMap</span></a>.</li>
<li>A sequence of <a class="reference internal" href="#term-scopedprogram"><span class="xref std std-term">ScopedProgram</span></a> or <a class="reference internal" href="#term-externalkernel"><span class="xref std std-term">ExternalKernel</span></a></li>
</ul>
</div>
</div></blockquote>
</dd>
<dt id="term-globalvariablemap"><cite>GlobalVariableMap</cite></dt>
<dd>a map of global variables to values used through the whole <a class="reference internal" href="#term-program"><span class="xref std std-term">Program</span></a></dd>
<dt id="term-externalkernel"><cite>ExternalKernel</cite></dt>
<dd><p class="first">describes the call to a external kernels.</p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>a sequence of input and output <a class="reference internal" href="#term-fielddecl"><span class="xref std std-term">FieldDecl</span></a> âs.</li>
</ul>
</div>
</dd>
<dt id="term-scopedprogram"><cite>ScopedProgram</cite></dt>
<dd><p class="first">Provides the control flow of a component of the full model.</p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>a list&lt;<a class="reference internal" href="#term-fielddecl"><span class="xref std std-term">FieldDecl</span></a>&gt; used within the program</li>
<li>a <a class="reference internal" href="#term-controlflowgraph"><span class="xref std std-term">ControlFlowGraph</span></a></li>
</ul>
</div>
<div class="attention last admonition">
<p class="first admonition-title">Example:</p>
<p>The following pseudo-code represents a <a class="reference internal" href="#term-scopedprogram"><span class="xref std std-term">ScopedProgram</span></a> where <cite>conjugate_gradient_solver</cite> is the actual <a class="reference internal" href="#term-verticalregioncomputationdecl"><span class="xref std std-term">VerticalRegionComputationDecl</span></a>
that contains the grid points calculations that operates on fields <cite>f</cite> and <cite>g</cite></p>
<div class="code c++ last highlight-default"><div class="highlight"><pre><span class="k">for</span><span class="p">(</span><span class="nb">iter</span><span class="p">:</span> <span class="nb">range</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">field</span> <span class="o">=</span> <span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">;</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">conjugate_gradient_solver</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</dd>
<dt id="term-controlflowgraph"><cite>ControlFlowGraph</cite></dt>
<dd><p class="first">a sequence of statements of a control flow</p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>a list&lt;<a class="reference internal" href="#term-controlflowgraphstmt"><span class="xref std std-term">ControlFlowGraphStmt</span></a>&gt;</li>
</ul>
</div>
<div class="attention last admonition">
<p class="first admonition-title">Example:</p>
<p>The following pseudo-code within a <a class="reference internal" href="#term-scopedprogram"><span class="xref std std-term">ScopedProgram</span></a></p>
<div class="code c++ highlight-default"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="n">tstep</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">call</span> <span class="n">hdiff1</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="n">call</span> <span class="n">hdiff2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">u</span> <span class="o">-=</span> <span class="n">u_ref</span>
</pre></div>
</div>
<p>is represented by the following <a class="reference internal" href="#term-controlflowgraph"><span class="xref std std-term">ControlFlowGraph</span></a></p>
<img alt="_images/controlflowexample.png" class="last" src="_images/controlflowexample.png" />
</div>
</dd>
<dt id="term-controlflowgraphstmt"><cite>ControlFlowGraphStmt</cite></dt>
<dd><p class="first">A statement node of a <a class="reference internal" href="#term-controlflowgraph"><span class="xref std std-term">ControlFlowGraph</span></a>.</p>
<div class="tip last admonition">
<p class="first admonition-title">It is any of</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-verticalregioncomputationdecl"><span class="xref std std-term">VerticalRegionComputationDecl</span></a>, <a class="reference internal" href="#term-ifstmt"><span class="xref std std-term">IfStmt</span></a>, <a class="reference internal" href="#term-blockstmt"><span class="xref std std-term">BlockStmt</span></a>, <a class="reference internal" href="#term-callstmt"><span class="xref std std-term">CallStmt</span></a>, <a class="reference internal" href="#term-vardecl"><span class="xref std std-term">VarDecl</span></a></li>
</ul>
</div>
</dd>
<dt id="term-ifstmt"><cite>IfStmt</cite></dt>
<dd><p class="first">an if/then/else block statement</p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>a condition of type <a class="reference internal" href="#term-controlflowgraphstmt"><span class="xref std std-term">ControlFlowGraphStmt</span></a> || <a class="reference internal" href="#term-computationstmt"><span class="xref std std-term">ComputationStmt</span></a></li>
<li>a <cite>then</cite> statement of type <a class="reference internal" href="#term-controlflowgraphstmt"><span class="xref std std-term">ControlFlowGraphStmt</span></a> || <a class="reference internal" href="#term-computationstmt"><span class="xref std std-term">ComputationStmt</span></a></li>
<li>an <cite>else</cite> of type <a class="reference internal" href="#term-controlflowgraphstmt"><span class="xref std std-term">ControlFlowGraphStmt</span></a> || <a class="reference internal" href="#term-computationstmt"><span class="xref std std-term">ComputationStmt</span></a></li>
</ul>
</div>
<div class="note last admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-controlflowgraphstmt"><span class="xref std std-term">ControlFlowGraphStmt</span></a></li>
<li><a class="reference internal" href="#term-computationstmt"><span class="xref std std-term">ComputationStmt</span></a></li>
</ul>
</div>
</dd>
<dt id="term-blockstmt"><cite>BlockStmt</cite></dt>
<dd><p class="first">a block of any number of statements.</p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>a list&lt;<a class="reference internal" href="#term-controlflowgraphstmt"><span class="xref std std-term">ControlFlowGraphStmt</span></a> || <a class="reference internal" href="#term-computationstmt"><span class="xref std std-term">ComputationStmt</span></a> &gt;</li>
</ul>
</div>
<div class="note last admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-controlflowgraphstmt"><span class="xref std std-term">ControlFlowGraphStmt</span></a></li>
<li><a class="reference internal" href="#term-computationstmt"><span class="xref std std-term">ComputationStmt</span></a></li>
</ul>
</div>
</dd>
<dt id="term-callstmt"><cite>CallStmt</cite></dt>
<dd><p class="first">a statement call to another <a class="reference internal" href="#term-scopedprogram"><span class="xref std std-term">ScopedProgram</span></a>, <a class="reference internal" href="#term-externalkernel"><span class="xref std std-term">ExternalKernel</span></a> or <a class="reference internal" href="#term-boundaryconditiondecl"><span class="xref std std-term">BoundaryConditionDecl</span></a></p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>A list of argument <a class="reference internal" href="#term-fielddecl"><span class="xref std std-term">FieldDecl</span></a> âs</li>
<li>One of <a class="reference internal" href="#term-scopedprogram"><span class="xref std std-term">ScopedProgram</span></a>, <a class="reference internal" href="#term-externalkernel"><span class="xref std std-term">ExternalKernel</span></a> or <a class="reference internal" href="#term-boundaryconditiondecl"><span class="xref std std-term">BoundaryConditionDecl</span></a></li>
</ul>
</div>
<div class="note admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-controlflowgraphstmt"><span class="xref std std-term">ControlFlowGraphStmt</span></a></li>
</ul>
</div>
<div class="attention last admonition">
<p class="first admonition-title">Example:</p>
<div class="code Fortran last highlight-default"><div class="highlight"><pre><span class="n">Program</span> <span class="n">radiation</span> <span class="p">{</span>
  <span class="n">Field</span> <span class="n">pca1</span><span class="p">,</span> <span class="n">pca2</span>
  <span class="n">call</span> <span class="n">boundary_condition</span><span class="p">(</span><span class="n">zero_gradient</span><span class="p">,</span> <span class="n">pca1</span><span class="p">)</span> <span class="o">//</span> <span class="o">-&gt;</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">CallStmt</span> <span class="n">to</span> <span class="n">a</span> <span class="n">BC</span>
  <span class="n">call</span> <span class="n">lw_solver</span><span class="p">(</span><span class="n">pca1</span><span class="p">,</span> <span class="n">pca2</span><span class="p">)</span>  <span class="o">//</span> <span class="o">-&gt;</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">CallStmt</span> <span class="n">to</span> <span class="n">a</span> <span class="n">ScopedProgram</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</dd>
<dt id="term-boundaryconditiondecl"><cite>BoundaryConditionDecl</cite></dt>
<dd><p class="first">a declaration of a boundary condition computation. It is an alias of a <a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a></p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>a <a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a></li>
</ul>
</div>
</dd>
<dt id="term-interval"><cite>Interval</cite></dt>
<dd>describes a vertical interval, determined by the lower and the upper bound.</dd>
<dt id="term-fielddecl"><cite>FieldDecl</cite></dt>
<dd><p class="first">storage in a N-D gridded space that is referenced by in the HIR by its name.
All <a class="reference internal" href="#term-fielddecl"><span class="xref std std-term">FieldDecl</span></a> âs, with is_temporary==false,  will be arguments of a call to a <cite>:term:`ScopedProgram</cite> or <a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a></p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>string: name</li>
<li>bool: is_temporary</li>
</ul>
</div>
<div class="note last admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li>a <a class="reference internal" href="#term-scopedprogram"><span class="xref std std-term">ScopedProgram</span></a></li>
<li>a <a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a></li>
</ul>
</div>
</dd>
<dt id="term-vardecl"><cite>VarDecl</cite></dt>
<dd><p class="first">a variable that represents a N-dimensional scalar.</p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-type"><span class="xref std std-term">Type</span></a>: type</li>
<li>string: name</li>
<li>int: dimension of the variable (0 for gridded <a class="reference internal" href="#term-fielddecl"><span class="xref std std-term">FieldDecl</span></a>)</li>
<li>string: operation to initialize the variable</li>
</ul>
</div>
<div class="note admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-controlflowgraph"><span class="xref std std-term">ControlFlowGraph</span></a></li>
<li><a class="reference internal" href="#term-computationast"><span class="xref std std-term">ComputationAST</span></a></li>
</ul>
</div>
<div class="attention last admonition">
<p class="first admonition-title">Example:</p>
<div class="code c++ last highlight-default"><div class="highlight"><pre><span class="n">Program</span> <span class="n">model</span> <span class="p">{</span>
  <span class="n">storage</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">;</span>
  <span class="n">var</span> <span class="n">v1</span><span class="p">;</span>                 <span class="o">//</span>  <span class="o">-&gt;</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">gridded</span> <span class="n">storage</span> <span class="n">variable</span> <span class="n">declaration</span>
  <span class="n">var</span> <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">};</span>  <span class="o">//</span>  <span class="o">-&gt;</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="mi">3</span> <span class="n">dimensional</span> <span class="n">scalar</span> <span class="n">variable</span> <span class="k">with</span> <span class="n">initialization</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</dd>
<dt id="term-verticalregioncomputationdecl"><cite>VerticalRegionComputationDecl</cite></dt>
<dd><p class="first">declaration of the computations within a vertical region (determined by an <a class="reference internal" href="#term-interval"><span class="xref std std-term">Interval</span></a>), that are executed with a certain vertical loop order</p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>a <a class="reference internal" href="#term-looporder"><span class="xref std std-term">LoopOrder</span></a></li>
<li>an <a class="reference internal" href="#term-computationast"><span class="xref std std-term">ComputationAST</span></a></li>
<li>an <a class="reference internal" href="#term-interval"><span class="xref std std-term">Interval</span></a> where the statements of the <cite>ComputationAST</cite> are computed</li>
</ul>
</div>
<div class="note admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li>a <a class="reference internal" href="#term-scopedprogram"><span class="xref std std-term">ScopedProgram</span></a></li>
</ul>
</div>
<div class="attention last admonition">
<p class="first admonition-title">Example:</p>
<p>The backward substitution of the thomas algorithm</p>
<div class="math">
\[\begin{split}x_{n} &amp;= d'_{n} \\
x_{i} &amp;= d'_{i} -c'_{i}x_{i+1} \;\;\; ; i=n-1, n-2,...,1\end{split}\]</div>
<p class="last">can be coded as two <cite>VerticalRegionComputationDecl</cite> âs, with different <a class="reference internal" href="#term-computationast"><span class="xref std std-term">ComputationAST</span></a>, one for the update of the boundary level <cite>n</cite> and another one with a backward loop in the interval [n-1,1]</p>
</div>
</dd>
<dt id="term-looporder"><cite>LoopOrder</cite></dt>
<dd><p class="first">a loop order.</p>
<div class="tip last admonition">
<p class="first admonition-title">It can be any of</p>
<ul class="last simple">
<li>enum: increment, enum: decrement</li>
</ul>
</div>
</dd>
<dt id="term-computationast"><cite>ComputationAST</cite></dt>
<dd><p class="first">a sequence of statement nodes that describe the grid-point computations of a <a class="reference internal" href="#term-verticalregioncomputationdecl"><span class="xref std std-term">VerticalRegionComputationDecl</span></a> or a <a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a></p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>one or more than one <a class="reference internal" href="#term-computationstmt"><span class="xref std std-term">ComputationStmt</span></a></li>
</ul>
</div>
<div class="admonition-it-can-be-used-in-class-note admonition">
<p class="first admonition-title">It can be used in
:class:: note</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-verticalregioncomputationdecl"><span class="xref std std-term">VerticalRegionComputationDecl</span></a></li>
<li><a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a></li>
</ul>
</div>
<div class="attention last admonition">
<p class="first admonition-title">Example:</p>
<p>The following pseudocode</p>
<div class="code c++ highlight-default"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="n">tstep</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">field</span><span class="p">[]</span> <span class="o">=</span> <span class="n">avg</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">field</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">field</span><span class="o">*</span><span class="n">coeff</span><span class="p">;</span>
</pre></div>
</div>
<p>will be represented as with the following AST</p>
<img alt="_images/astexample.png" class="last" src="_images/astexample.png" />
</div>
</dd>
<dt id="term-computationstmt"><cite>ComputationStmt</cite></dt>
<dd><p class="first">a computation statement, i.e. a node of the <a class="reference internal" href="#term-computationast"><span class="xref std std-term">ComputationAST</span></a>.</p>
<div class="tip admonition">
<p class="first admonition-title">It can be any of</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-blockstmt"><span class="xref std std-term">BlockStmt</span></a>, <a class="reference internal" href="#term-exprstmt"><span class="xref std std-term">ExprStmt</span></a>, <a class="reference internal" href="#term-returnstmt"><span class="xref std std-term">ReturnStmt</span></a> (only if the <a class="reference internal" href="#term-computationast"><span class="xref std std-term">ComputationAST</span></a> belongs to a <a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a>), <a class="reference internal" href="#term-stencilfuncallexpr"><span class="xref std std-term">StencilFunCallExpr</span></a>, <a class="reference internal" href="#term-vardecl"><span class="xref std std-term">VarDecl</span></a>, <a class="reference internal" href="#term-ifstmt"><span class="xref std std-term">IfStmt</span></a></li>
</ul>
</div>
<div class="note last admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-computationast"><span class="xref std std-term">ComputationAST</span></a></li>
</ul>
</div>
</dd>
<dt id="term-returnstmt"><cite>ReturnStmt</cite></dt>
<dd><p class="first">a return statement</p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>a <a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a> to return</li>
</ul>
</div>
</dd>
<dt id="term-exprstmt"><cite>ExprStmt</cite></dt>
<dd>a statement that encloses a <a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a></dd>
<dt id="term-expr"><cite>Expr</cite></dt>
<dd>a expression, i.e. anything that contains a <a class="reference internal" href="#term-identifier"><span class="xref std std-term">Identifier</span></a>, <a class="reference internal" href="#term-literalexpr"><span class="xref std std-term">LiteralExpr</span></a>, <a class="reference internal" href="#term-operatorexpr"><span class="xref std std-term">OperatorExpr</span></a></dd>
<dt id="term-identifier"><cite>Identifier</cite></dt>
<dd><div class="tip first last admonition">
<p class="first admonition-title">It can be any of</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-varaccessexpr"><span class="xref std std-term">VarAccessExpr</span></a>, <a class="reference internal" href="#term-fieldaccessexpr"><span class="xref std std-term">FieldAccessExpr</span></a></li>
</ul>
</div>
</dd>
<dt id="term-varaccessexpr"><cite>VarAccessExpr</cite></dt>
<dd><p class="first">an expression that represents an access to a variable</p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-vardecl"><span class="xref std std-term">VarDecl</span></a></li>
<li><a class="reference internal" href="#term-literalexpr"><span class="xref std std-term">LiteralExpr</span></a>: access index of the var has more than 1 dimensions</li>
</ul>
</div>
<div class="attention last admonition">
<p class="first admonition-title">Example:</p>
<div class="code c++ last highlight-default"><div class="highlight"><pre><span class="nb">globals</span> <span class="p">{</span>
  <span class="nb">int</span> <span class="n">tstep</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Program</span> <span class="n">model</span> <span class="p">{</span>
  <span class="n">var</span> <span class="n">wght</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
  <span class="k">if</span><span class="p">(</span><span class="n">tstep</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span>  <span class="o">//</span> <span class="o">-&gt;</span> <span class="n">tstep</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">VarAccessExpr</span> <span class="p">(</span><span class="n">to</span> <span class="k">global</span> <span class="n">variable</span><span class="p">)</span>
     <span class="n">wght</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">++</span><span class="p">;</span>   <span class="o">//</span> <span class="o">-&gt;</span> <span class="n">wght</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">VarAccessExpr</span> <span class="k">with</span> <span class="n">an</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</dd>
<dt id="term-fieldaccessexpr"><cite>FieldAccessExpr</cite></dt>
<dd><p class="first">an expression that represents an access to a field</p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-fielddecl"><span class="xref std std-term">FieldDecl</span></a></li>
<li>list&lt;<a class="reference internal" href="#term-offset"><span class="xref std std-term">Offset</span></a>&gt;</li>
</ul>
</div>
</dd>
<dt id="term-literalexpr"><cite>LiteralExpr</cite></dt>
<dd><p class="first">expression that represents a literal</p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>string: value</li>
<li>Type: type</li>
</ul>
</div>
</dd>
<dt id="term-type"><cite>Type</cite></dt>
<dd>a type representation</dd>
<dt id="term-operatorexpr"><cite>OperatorExpr</cite></dt>
<dd><p class="first">an expression that represents an operator</p>
<div class="tip last admonition">
<p class="first admonition-title">It can be any of</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-binaryopexpr"><span class="xref std std-term">BinaryOpExpr</span></a>, <a class="reference internal" href="#term-unaryopexpr"><span class="xref std std-term">UnaryOpExpr</span></a>, <a class="reference internal" href="#term-assignmentopexpr"><span class="xref std std-term">AssignmentOpExpr</span></a>, <a class="reference internal" href="#term-ternaryopexpr"><span class="xref std std-term">TernaryOpExpr</span></a>, <a class="reference internal" href="#term-stencilfuncallexpr"><span class="xref std std-term">StencilFunCallExpr</span></a></li>
</ul>
</div>
</dd>
<dt id="term-binaryopexpr"><cite>BinaryOpExpr</cite></dt>
<dd><p class="first">a binary operator expression</p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a>: left</li>
<li>string: operator</li>
<li><a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a>: right</li>
</ul>
</div>
</dd>
<dt id="term-unaryopexpr"><cite>UnaryOpExpr</cite></dt>
<dd><p class="first">a unary operator expression</p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>string: operator</li>
<li><a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a>: operand</li>
</ul>
</div>
</dd>
<dt id="term-assignmentopexpr"><cite>AssignmentOpExpr</cite></dt>
<dd><p class="first">an assignment operator expression</p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a>: left</li>
<li>string: operator</li>
<li><a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a>: right</li>
</ul>
</div>
</dd>
<dt id="term-ternaryopexpr"><cite>TernaryOpExpr</cite></dt>
<dd><p class="first">an ternary operator expression</p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a>: condition</li>
<li><a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a>: left</li>
<li><a class="reference internal" href="#term-expr"><span class="xref std std-term">Expr</span></a>: right</li>
</ul>
</div>
</dd>
<dt id="term-stencilfuncallexpr"><cite>StencilFunCallExpr</cite></dt>
<dd><p class="first">a stencil function call expression</p>
<div class="tip last admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a></li>
<li>list&lt;<a class="reference internal" href="#term-stencilfunctionarg"><span class="xref std std-term">StencilFunctionArg</span></a>&gt;: arguments</li>
</ul>
</div>
</dd>
<dt id="term-offset"><cite>Offset</cite></dt>
<dd><p class="first">Relative distance in a given <cite>Direction</cite> to a neighbor grid point.</p>
<div class="note admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-fielddecl"><span class="xref std std-term">FieldDecl</span></a> accesses</li>
<li>As argument of <a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a> âs.</li>
</ul>
</div>
<div class="attention last admonition">
<p class="first admonition-title">Example:</p>
<p class="last"><cite>i+1</cite>, [1,0,0]</p>
</div>
</dd>
<dt id="term-direction"><cite>Direction</cite></dt>
<dd><p class="first">Identifies a dimension. A direction is also treated as an <a class="reference internal" href="#term-offset"><span class="xref std std-term">Offset</span></a> with distance 0.
It is mainly used to parameterize the direction of numerical operators in stencil functions.</p>
<div class="note admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-fielddecl"><span class="xref std std-term">FieldDecl</span></a> accesses</li>
<li>as argument of <a class="reference internal" href="#term-stencilfunctiondecl"><span class="xref std std-term">StencilFunctionDecl</span></a> âs.</li>
</ul>
</div>
<div class="attention last admonition">
<p class="first admonition-title">Example:</p>
<blockquote class="last">
<div><cite>avg(j, field)</cite></div></blockquote>
</div>
</dd>
<dt id="term-stencilfunctionarg"><cite>StencilFunctionArg</cite></dt>
<dd><p class="first">a stencil function argument</p>
<div class="tip last admonition">
<p class="first admonition-title">It is any of</p>
<ul class="last simple">
<li><a class="reference internal" href="#term-offset"><span class="xref std std-term">Offset</span></a>, <a class="reference internal" href="#term-direction"><span class="xref std std-term">Direction</span></a>, <a class="reference internal" href="#term-fielddecl"><span class="xref std std-term">FieldDecl</span></a>, <a class="reference internal" href="#term-stencilfuncallexpr"><span class="xref std std-term">StencilFunCallExpr</span></a></li>
</ul>
</div>
</dd>
<dt id="term-stencilfunctiondecl"><cite>StencilFunctionDecl</cite></dt>
<dd><p class="first">A parameterized function applied to a grid point that contains stencil operations.</p>
<div class="tip admonition">
<p class="first admonition-title">It has</p>
<ul class="last simple">
<li>list&lt;<a class="reference internal" href="#term-interval"><span class="xref std std-term">Interval</span></a>&gt;: intervals for which there are different specializations of the computation.</li>
<li>list&lt;<a class="reference internal" href="#term-computationast"><span class="xref std std-term">ComputationAST</span></a>&gt;: a computation AST for each <a class="reference internal" href="#term-interval"><span class="xref std std-term">Interval</span></a>.</li>
<li>list&lt;<a class="reference internal" href="#term-stencilfunctionarg"><span class="xref std std-term">StencilFunctionArg</span></a>&gt;: list of arguments that are common to the specializations of all <a class="reference internal" href="#term-interval"><span class="xref std std-term">Interval</span></a> âs.</li>
</ul>
</div>
<div class="note last admonition">
<p class="first admonition-title">It can be used in</p>
<ul class="last simple">
<li>a <a class="reference internal" href="#term-computationast"><span class="xref std std-term">ComputationAST</span></a></li>
</ul>
</div>
</dd>
</dl>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hir_design.html" class="btn btn-neutral float-right" title="HIR Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basics.html" class="btn btn-neutral" title="First steps" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, ETH Zurich and MeteoSwiss.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>